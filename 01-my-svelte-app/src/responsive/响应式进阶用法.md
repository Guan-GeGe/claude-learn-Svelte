## ğŸ¤– Assistant

æˆ‘æ¥ä¸ºä½ ç”Ÿæˆä¸€ä»½å®Œæ•´çš„ Svelte 5 Runes æ€»ç»“æ–‡æ¡£ã€‚

```markdown
# Svelte 5 Runes å®Œå…¨æŒ‡å—

## ç›®å½•
- [æ ¸å¿ƒæ¦‚å¿µ](#æ ¸å¿ƒæ¦‚å¿µ)
- [$state - å“åº”å¼çŠ¶æ€](#state---å“åº”å¼çŠ¶æ€)
- [$derived - æ´¾ç”ŸçŠ¶æ€](#derived---æ´¾ç”ŸçŠ¶æ€)
- [$derived.by - å¤æ‚æ´¾ç”Ÿ](#derivedby---å¤æ‚æ´¾ç”Ÿ)
- [$effect - å‰¯ä½œç”¨](#effect---å‰¯ä½œç”¨)
- [$state.raw - éå“åº”å¼çŠ¶æ€](#stateraw---éå“åº”å¼çŠ¶æ€)
- [$state.snapshot - çŠ¶æ€å¿«ç…§](#statesnapshot---çŠ¶æ€å¿«ç…§)
- [å†³ç­–æ ‘](#å†³ç­–æ ‘)
- [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)

---

## æ ¸å¿ƒæ¦‚å¿µ

Svelte 5 å¼•å…¥ Runes ç³»ç»Ÿï¼Œæ›¿ä»£æ—§çš„ `$:` å“åº”å¼è¯­æ³•ã€‚Runes æ˜¯ä»¥ `$` å¼€å¤´çš„ç‰¹æ®Šå‡½æ•°ï¼Œåœ¨ç¼–è¯‘æ—¶å¤„ç†ã€‚

**ä¸»è¦å˜åŒ–ï¼š**
- `let x = 0` â†’ `let x = $state(0)`
- `$: y = x * 2` â†’ `let y = $derived(x * 2)`
- `$: console.log(x)` â†’ `$effect(() => console.log(x))`
- `on:click` â†’ `onclick`

---

## $state - å“åº”å¼çŠ¶æ€

### åŸºæœ¬ç”¨æ³•

```svelte
<script>
  let count = $state(0);
  let name = $state('å¼ ä¸‰');
</script>

<button onclick={() => count++}>
  {name}: {count}
</button>
```

### å¯¹è±¡å’Œæ•°ç»„

```svelte
<script>
  // å¯¹è±¡
  let user = $state({
    name: 'å¼ ä¸‰',
    age: 25
  });
  
  // æ•°ç»„
  let items = $state(['è‹¹æœ', 'é¦™è•‰', 'æ©™å­']);
  
  function updateUser() {
    user.age++;  // ç›´æ¥ä¿®æ”¹
  }
  
  function addItem() {
    items.push('è‘¡è„');  // ç›´æ¥ push
  }
</script>
```

### åµŒå¥—å¯¹è±¡

```svelte
<script>
  let data = $state({
    user: {
      profile: {
        name: 'å¼ ä¸‰',
        address: {
          city: 'åŒ—äº¬'
        }
      }
    }
  });
  
  // æ·±å±‚ä¿®æ”¹ä¹Ÿä¼šè§¦å‘æ›´æ–°
  function updateCity() {
    data.user.profile.address.city = 'ä¸Šæµ·';
  }
</script>
```

### ä½¿ç”¨åœºæ™¯
- âœ… è¡¨å•è¾“å…¥
- âœ… ç”¨æˆ·äº¤äº’çŠ¶æ€
- âœ… ç»„ä»¶å†…éƒ¨çŠ¶æ€
- âœ… åˆ—è¡¨æ•°æ®
- âŒ å¤§å‹æ•°æ®é›†ï¼ˆä½¿ç”¨ $state.rawï¼‰

---

## $derived - æ´¾ç”ŸçŠ¶æ€

### åŸºæœ¬ç”¨æ³•

```svelte
<script>
  let price = $state(100);
  let quantity = $state(2);
  
  let total = $derived(price * quantity);
  let tax = $derived(total * 0.1);
  let finalPrice = $derived(total + tax);
</script>

<p>æ€»ä»·: Â¥{finalPrice}</p>
```

### å¸¸è§åœºæ™¯

#### 1. æ•°ç»„è¿‡æ»¤å’Œæ˜ å°„

```svelte
<script>
  let users = $state([
    { name: 'å¼ ä¸‰', age: 25, active: true },
    { name: 'æå››', age: 30, active: false },
    { name: 'ç‹äº”', age: 22, active: true }
  ]);
  
  let searchTerm = $state('');
  
  // è¿‡æ»¤
  let filteredUsers = $derived(
    users.filter(u => u.name.includes(searchTerm))
  );
  
  // ç»Ÿè®¡
  let activeCount = $derived(
    users.filter(u => u.active).length
  );
  
  // è®¡ç®—
  let avgAge = $derived(
    users.reduce((sum, u) => sum + u.age, 0) / users.length
  );
</script>
```

#### 2. æ ¼å¼åŒ–

```svelte
<script>
  let date = $state(new Date());
  let amount = $state(1234.56);
  
  let formattedDate = $derived(
    date.toLocaleDateString('zh-CN')
  );
  
  let formattedAmount = $derived(
    `Â¥${amount.toFixed(2)}`
  );
</script>
```

#### 3. å¸ƒå°”åˆ¤æ–­

```svelte
<script>
  let password = $state('');
  
  let isValid = $derived(password.length >= 8);
  let hasNumber = $derived(/\d/.test(password));
  let hasLetter = $derived(/[a-zA-Z]/.test(password));
  let isStrong = $derived(isValid && hasNumber && hasLetter);
</script>

<input type="password" bind:value={password} />
<p>å¼ºåº¦: {isStrong ? 'å¼º' : 'å¼±'}</p>
```

### ä½¿ç”¨åœºæ™¯
- âœ… ç®€å•è®¡ç®—ï¼ˆ1è¡Œä»£ç ï¼‰
- âœ… æ•°ç»„æ–¹æ³•ï¼ˆfilter, map, reduceï¼‰
- âœ… å­—ç¬¦ä¸²æ“ä½œ
- âœ… æ•°å­¦è¿ç®—
- âŒ éœ€è¦ä¸­é—´å˜é‡ï¼ˆä½¿ç”¨ $derived.byï¼‰

---

## $derived.by - å¤æ‚æ´¾ç”Ÿ

### åŸºæœ¬ç”¨æ³•

```svelte
<script>
  let numbers = $state([1, 2, 3, 4, 5]);
  
  let stats = $derived.by(() => {
    const sum = numbers.reduce((a, b) => a + b, 0);
    const avg = sum / numbers.length;
    const sorted = [...numbers].sort((a, b) => a - b);
    const median = sorted[Math.floor(sorted.length / 2)];
    
    return { sum, avg, median };
  });
</script>

<p>æ€»å’Œ: {stats.sum}</p>
<p>å¹³å‡: {stats.avg}</p>
<p>ä¸­ä½æ•°: {stats.median}</p>
```

### å®æˆ˜ç¤ºä¾‹

#### 1. è®¢å•ç»Ÿè®¡

```svelte
<script>
  let orders = $state([
    { id: 1, items: [10, 20, 30], status: 'paid' },
    { id: 2, items: [15, 25], status: 'pending' },
    { id: 3, items: [50], status: 'paid' }
  ]);
  
  let summary = $derived.by(() => {
    const paid = orders.filter(o => o.status === 'paid');
    const pending = orders.filter(o => o.status === 'pending');
    
    const totalRevenue = paid.reduce((sum, o) => 
      sum + o.items.reduce((a, b) => a + b, 0), 0
    );
    
    const avgOrderValue = paid.length > 0 
      ? totalRevenue / paid.length 
      : 0;
    
    return {
      paidCount: paid.length,
      pendingCount: pending.length,
      totalRevenue,
      avgOrderValue
    };
  });
</script>

<div>
  <p>å·²ä»˜æ¬¾: {summary.paidCount}</p>
  <p>å¾…ä»˜æ¬¾: {summary.pendingCount}</p>
  <p>æ€»æ”¶å…¥: Â¥{summary.totalRevenue}</p>
  <p>å¹³å‡è®¢å•: Â¥{summary.avgOrderValue.toFixed(2)}</p>
</div>
```

#### 2. å¤æ‚æœç´¢è¿‡æ»¤

```svelte
<script>
  let products = $state([
    { name: 'iPhone', price: 5999, category: 'æ‰‹æœº', stock: 10 },
    { name: 'iPad', price: 3999, category: 'å¹³æ¿', stock: 0 },
    { name: 'MacBook', price: 9999, category: 'ç”µè„‘', stock: 5 }
  ]);
  
  let filters = $state({
    search: '',
    maxPrice: 10000,
    inStockOnly: false
  });
  
  let filtered = $derived.by(() => {
    let result = products;
    
    // æœç´¢è¿‡æ»¤
    if (filters.search) {
      const term = filters.search.toLowerCase();
      result = result.filter(p => 
        p.name.toLowerCase().includes(term) ||
        p.category.toLowerCase().includes(term)
      );
    }
    
    // ä»·æ ¼è¿‡æ»¤
    result = result.filter(p => p.price <= filters.maxPrice);
    
    // åº“å­˜è¿‡æ»¤
    if (filters.inStockOnly) {
      result = result.filter(p => p.stock > 0);
    }
    
    // æ’åº
    return result.sort((a, b) => a.price - b.price);
  });
</script>
```

### ä½¿ç”¨åœºæ™¯
- âœ… éœ€è¦ä¸­é—´å˜é‡
- âœ… å¤šæ­¥éª¤è®¡ç®—
- âœ… å¤æ‚æ•°æ®è½¬æ¢
- âœ… éœ€è¦æå‰è¿”å›
- âœ… è¶…è¿‡ 3 è¡Œä»£ç çš„é€»è¾‘

---

## $effect - å‰¯ä½œç”¨

### åŸºæœ¬ç”¨æ³•

```svelte
<script>
  let count = $state(0);
  
  $effect(() => {
    console.log('count å˜åŒ–:', count);
  });
</script>
```

### å¸¦æ¸…ç†å‡½æ•°

```svelte
<script>
  let count = $state(0);
  
  $effect(() => {
    const timer = setInterval(() => {
      console.log('å½“å‰è®¡æ•°:', count);
    }, 1000);
    
    // æ¸…ç†å‡½æ•°
    return () => {
      clearInterval(timer);
    };
  });
</script>
```

### å¸¸è§åœºæ™¯

#### 1. localStorage åŒæ­¥

```svelte
<script>
  let theme = $state('light');
  
  // ä¿å­˜
  $effect(() => {
    localStorage.setItem('theme', theme);
  });
  
  // åŠ è½½
  $effect(() => {
    const saved = localStorage.getItem('theme');
    if (saved) {
      theme = saved;
    }
  });
</script>
```

#### 2. ä¿®æ”¹ document

```svelte
<script>
  let title = $state('é¦–é¡µ');
  let theme = $state('light');
  
  $effect(() => {
    document.title = title;
  });
  
  $effect(() => {
    document.body.className = theme;
  });
</script>
```

#### 3. äº‹ä»¶ç›‘å¬

```svelte
<script>
  let windowWidth = $state(0);
  
  $effect(() => {
    function handleResize() {
      windowWidth = window.innerWidth;
    }
    
    window.addEventListener('resize', handleResize);
    handleResize();
    
    return () => {
      window.removeEventListener('resize', handleResize);
    };
  });
</script>

<p>çª—å£å®½åº¦: {windowWidth}px</p>
```

#### 4. è¡¨å•è‡ªåŠ¨ä¿å­˜

```svelte
<script>
  let formData = $state({
    name: '',
    email: '',
    message: ''
  });
  
  let lastSaved = $state(null);
  
  // é˜²æŠ–ä¿å­˜
  $effect(() => {
    const timer = setTimeout(() => {
      localStorage.setItem('draft', JSON.stringify(formData));
      lastSaved = new Date();
    }, 1000);
    
    return () => clearTimeout(timer);
  });
</script>

<input bind:value={formData.name} />
<input bind:value={formData.email} />
<textarea bind:value={formData.message}></textarea>

{#if lastSaved}
  <p>æœ€åä¿å­˜: {lastSaved.toLocaleTimeString()}</p>
{/if}
```

#### 5. WebSocket è¿æ¥

```svelte
<script>
  let messages = $state([]);
  let connected = $state(false);
  
  $effect(() => {
    const ws = new WebSocket('ws://localhost:8080');
    
    ws.onopen = () => {
      connected = true;
    };
    
    ws.onmessage = (event) => {
      messages.push(JSON.parse(event.data));
    };
    
    ws.onclose = () => {
      connected = false;
    };
    
    return () => {
      ws.close();
    };
  });
</script>
```

### ä½¿ç”¨åœºæ™¯
- âœ… localStorage/sessionStorage
- âœ… document.title ä¿®æ”¹
- âœ… äº‹ä»¶ç›‘å¬å™¨
- âœ… å®šæ—¶å™¨/é—´éš”å™¨
- âœ… WebSocket/SSE
- âœ… ç¬¬ä¸‰æ–¹åº“é›†æˆ
- âœ… æ—¥å¿—/åˆ†æ
- âŒ ä¿®æ”¹çŠ¶æ€ï¼ˆä¼šå¯¼è‡´å¾ªç¯ï¼‰

### âš ï¸ æ³¨æ„äº‹é¡¹

```svelte
<script>
  let count = $state(0);
  
  // âŒ é”™è¯¯ï¼šæ— é™å¾ªç¯
  $effect(() => {
    count++;  // ä¸è¦åœ¨ effect ä¸­ä¿®æ”¹çŠ¶æ€
  });
  
  // âœ… æ­£ç¡®ï¼šåªè¯»å–
  $effect(() => {
    console.log(count);
  });
  
  // âœ… æ­£ç¡®ï¼šå“åº”å¤–éƒ¨äº‹ä»¶
  $effect(() => {
    function handleClick() {
      count++;
    }
    document.addEventListener('click', handleClick);
    return () => document.removeEventListener('click', handleClick);
  });
</script>
```

---

## $state.raw - éå“åº”å¼çŠ¶æ€

### åŸºæœ¬ç”¨æ³•

```svelte
<script>
  // å¤§å‹æ•°æ®ï¼Œä¸éœ€è¦å“åº”å¼
  let bigData = $state.raw(
    new Array(10000).fill(0).map((_, i) => ({
      id: i,
      value: Math.random()
    }))
  );
  
  // æ‰‹åŠ¨è§¦å‘æ›´æ–°
  let version = $state(0);
  
  function updateItem(index) {
    bigData[index].value = Math.random();
    version++;  // è§¦å‘é‡æ–°æ¸²æŸ“
  }
</script>

<button onclick={() => updateItem(0)}>æ›´æ–°</button>
<p>ç‰ˆæœ¬: {version}</p>
```

### å®æˆ˜ç¤ºä¾‹

#### 1. åœ°å›¾æ•°æ®

```svelte
<script>
  // 5000 ä¸ªåœ°å›¾æ ‡è®°ï¼ˆä¸éœ€è¦å“åº”å¼ï¼‰
  let markers = $state.raw(
    new Array(5000).fill(0).map(() => ({
      lat: Math.random() * 180 - 90,
      lng: Math.random() * 360 - 180,
      label: 'Marker'
    }))
  );
  
  // åªæœ‰é€‰ä¸­çš„æ ‡è®°éœ€è¦å“åº”å¼
  let selectedMarker = $state(null);
  let zoom = $state(10);
</script>
```

#### 2. é…ç½®å¯¹è±¡

```svelte
<script>
  // é™æ€é…ç½®
  let config = $state.raw({
    apiUrl: 'https://api.example.com',
    timeout: 5000,
    headers: {
      'Content-Type': 'application/json'
    }
  });
  
  // åŠ¨æ€çŠ¶æ€
  let loading = $state(false);
</script>
```

#### 3. ç¬¬ä¸‰æ–¹åº“æ•°æ®

```svelte
<script>
  import Chart from 'chart.js';
  
  // Chart.js æ•°æ®ç»“æ„ï¼ˆä¸éœ€è¦å“åº”å¼ï¼‰
  let chartData = $state.raw({
    labels: ['1æœˆ', '2æœˆ', '3æœˆ'],
    datasets: [{
      label: 'é”€å”®é¢',
      data: [100, 200, 150]
    }]
  });
  
  // åªæœ‰å›¾è¡¨å®ä¾‹éœ€è¦å“åº”å¼
  let chartInstance = $state(null);
</script>
```

### ä½¿ç”¨åœºæ™¯
- âœ… å¤§å‹æ•°ç»„/å¯¹è±¡ï¼ˆ>1000 é¡¹ï¼‰
- âœ… åªè¯»æ•°æ®
- âœ… é…ç½®å¯¹è±¡
- âœ… ç¬¬ä¸‰æ–¹åº“æ•°æ®
- âœ… é™æ€æŸ¥æ‰¾è¡¨
- âŒ éœ€è¦è‡ªåŠ¨æ›´æ–° UI çš„æ•°æ®

### æ€§èƒ½å¯¹æ¯”

```svelte
<script>
  // âŒ æ…¢ï¼šåˆ›å»º 10000 ä¸ªå“åº”å¼ä»£ç†
  let slowList = $state(
    new Array(10000).fill(0).map((_, i) => ({ id: i }))
  );
  
  // âœ… å¿«ï¼šæ™®é€šæ•°ç»„
  let fastList = $state.raw(
    new Array(10000).fill(0).map((_, i) => ({ id: i }))
  );
</script>
```

---

## $state.snapshot - çŠ¶æ€å¿«ç…§

### åŸºæœ¬ç”¨æ³•

```svelte
<script>
  let user = $state({
    name: 'å¼ ä¸‰',
    age: 25
  });
  
  // è·å–æ™®é€šå¯¹è±¡ï¼ˆéä»£ç†ï¼‰
  const snapshot = $state.snapshot(user);
  console.log(snapshot);  // { name: 'å¼ ä¸‰', age: 25 }
</script>
```

### å¸¸è§åœºæ™¯

#### 1. localStorage ä¿å­˜

```svelte
<script>
  let settings = $state({
    theme: 'light',
    language: 'zh-CN',
    notifications: true
  });
  
  function save() {
    const snapshot = $state.snapshot(settings);
    localStorage.setItem('settings', JSON.stringify(snapshot));
  }
  
  function load() {
    const data = localStorage.getItem('settings');
    if (data) {
      settings = $state(JSON.parse(data));
    }
  }
</script>
```

#### 2. HTTP è¯·æ±‚

```svelte
<script>
  let user = $state({
    name: 'å¼ ä¸‰',
    email: 'zhangsan@example.com',
    profile: {
      age: 25,
      city: 'åŒ—äº¬'
    }
  });
  
  async function saveToServer() {
    const snapshot = $state.snapshot(user);
    
    await fetch('/api/user', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(snapshot)
    });
  }
</script>
```

#### 3. æ·±åº¦æ¯”è¾ƒ

```svelte
<script>
  let formData = $state({
    name: 'å¼ ä¸‰',
    email: 'zhangsan@example.com'
  });
  
  // ä¿å­˜åŸå§‹æ•°æ®
  let originalData = $state.snapshot(formData);
  
  // æ£€æŸ¥æ˜¯å¦æœ‰æ›´æ”¹
  let hasChanges = $derived(() => {
    const current = $state.snapshot(formData);
    return JSON.stringify(current) !== JSON.stringify(originalData);
  });
  
  function reset() {
    formData = $state(originalData);
  }
</script>

<input bind:value={formData.name} />
<input bind:value={formData.email} />

{#if hasChanges}
  <button onclick={reset}>é‡ç½®</button>
  <button>ä¿å­˜</button>
{/if}
```

#### 4. æ’¤é”€/é‡åš

```svelte
<script>
  let data = $state({ text: '' });
  let history = $state([]);
  let historyIndex = $state(-1);
  
  function saveHistory() {
    const snapshot = $state.snapshot(data);
    history = [...history.slice(0, historyIndex + 1), snapshot];
    historyIndex++;
  }
  
  function undo() {
    if (historyIndex > 0) {
      historyIndex--;
      data = $state(history[historyIndex]);
    }
  }
  
  function redo() {
    if (historyIndex < history.length - 1) {
      historyIndex++;
      data = $state(history[historyIndex]);
    }
  }
</script>
```

### ä½¿ç”¨åœºæ™¯
- âœ… JSON åºåˆ—åŒ–
- âœ… HTTP è¯·æ±‚
- âœ… localStorage ä¿å­˜
- âœ… æ·±åº¦æ¯”è¾ƒ
- âœ… ä¼ é€’ç»™ç¬¬ä¸‰æ–¹åº“
- âœ… æ’¤é”€/é‡åšåŠŸèƒ½

---

## å†³ç­–æ ‘

```
éœ€è¦å­˜å‚¨æ•°æ®ï¼Ÿ
â”œâ”€ æ˜¯ â†’ æ•°æ®ä¼šå˜åŒ–å—ï¼Ÿ
â”‚      â”œâ”€ æ˜¯ â†’ æ•°æ®é‡å¤§å—ï¼ˆ>1000é¡¹ï¼‰ï¼Ÿ
â”‚      â”‚      â”œâ”€ æ˜¯ â†’ $state.raw
â”‚      â”‚      â””â”€ å¦ â†’ $state
â”‚      â””â”€ å¦ â†’ æ™®é€šå¸¸é‡
â”‚
â””â”€ å¦ â†’ éœ€è¦åŸºäºå…¶ä»–æ•°æ®è®¡ç®—å—ï¼Ÿ
       â”œâ”€ æ˜¯ â†’ è®¡ç®—é€»è¾‘å¤æ‚å—ï¼ˆ>3è¡Œï¼‰ï¼Ÿ
       â”‚      â”œâ”€ æ˜¯ â†’ $derived.by
       â”‚      â””â”€ å¦ â†’ $derived
       â”‚
       â””â”€ å¦ â†’ éœ€è¦æ‰§è¡Œå‰¯ä½œç”¨å—ï¼Ÿ
              â”œâ”€ æ˜¯ â†’ $effect
              â””â”€ å¦ â†’ æ™®é€šå‡½æ•°

éœ€è¦æ™®é€šå¯¹è±¡ï¼Ÿ
â””â”€ æ˜¯ â†’ $state.snapshot
```

---

## æœ€ä½³å®è·µ

### 1. å‘½åè§„èŒƒ

```svelte
<script>
  // çŠ¶æ€ï¼šåè¯
  let count = $state(0);
  let users = $state([]);
  
  // æ´¾ç”Ÿï¼šå½¢å®¹è¯æˆ–åè¯
  let isValid = $derived(count > 0);
  let total = $derived(count * 2);
  
  // å‡½æ•°ï¼šåŠ¨è¯
  function increment() {
    count++;
  }
</script>
```

### 2. é¿å…è¿‡åº¦æ´¾ç”Ÿ

```svelte
<script>
  let items = $state([1, 2, 3]);
  
  // âŒ ä¸å¥½ï¼šè¿‡åº¦æ´¾ç”Ÿ
  let doubled = $derived(items.map(x => x * 2));
  let tripled = $derived(items.map(x => x * 3));
  let quadrupled = $derived(items.map(x => x * 4));
  
  // âœ… å¥½ï¼šæŒ‰éœ€è®¡ç®—
  function multiply(n) {
    return items.map(x => x * n);
  }
</script>

<p>{multiply(2)}</p>
<p>{multiply(3)}</p>
```

### 3. åˆç†ä½¿ç”¨ $effect

```svelte
<script>
  let count = $state(0);
  
  // âŒ ä¸å¥½ï¼šå¤šä¸ª effect
  $effect(() => {
    console.log('count:', count);
  });
  $effect(() => {
    document.title = `Count: ${count}`;
  });
  $effect(() => {
    localStorage.setItem('count', count);
  });
  
  // âœ… å¥½ï¼šåˆå¹¶ç›¸å…³ effect
  $effect(() => {
    console.log('count:', count);
    document.title = `Count: ${count}`;
    localStorage.setItem('count', count);
  });
</script>
```

### 4. æ€§èƒ½ä¼˜åŒ–

```svelte
<script>
  let items = $state(new Array(10000).fill(0));
  
  // âŒ æ…¢ï¼šæ¯æ¬¡éƒ½é‡æ–°è®¡ç®—
  let sum = $derived(items.reduce((a, b) => a + b, 0));
  
  // âœ… å¿«ï¼šä½¿ç”¨ raw + æ‰‹åŠ¨æ›´æ–°
  let items = $state.raw(new Array(10000).fill(0));
  let sum = $state(0);
  
  function recalculate() {
    sum = items.reduce((a, b) => a + b, 0);
  }
</script>
```

### 5. ç±»å‹å®‰å…¨ï¼ˆTypeScriptï¼‰

```svelte
<script lang="ts">
  interface User {
    name: string;
    age: number;
  }
  
  let user = $state<User>({
    name: 'å¼ ä¸‰',
    age: 25
  });
  
  let greeting = $derived(`ä½ å¥½ï¼Œ${user.name}`);
</script>
```

---

## è®°å¿†å£è¯€

- **$state** = å­˜æ•°æ®
- **$derived** = ç®—ä¸€è¡Œ
- **$derived.by** = ç®—å¤šè¡Œ
- **$effect** = åšå‰¯ä½œç”¨
- **$state.raw** = å¤§æ•°æ®
- **$state.snapshot** = å˜æ™®é€š

---

## å¿«é€Ÿå‚è€ƒ

| Rune | ç”¨é€” | è¿”å›å€¼ | ä½•æ—¶ä½¿ç”¨ |
|------|------|--------|----------|
| `$state` | åˆ›å»ºå“åº”å¼çŠ¶æ€ | ä»£ç†å¯¹è±¡ | éœ€è¦å“åº”å¼çš„æ•°æ® |
| `$derived` | ç®€å•æ´¾ç”Ÿ | è®¡ç®—å€¼ | 1è¡Œè®¡ç®— |
| `$derived.by` | å¤æ‚æ´¾ç”Ÿ | è®¡ç®—å€¼ | å¤šè¡Œè®¡ç®— |
| `$effect` | å‰¯ä½œç”¨ | æ—  | éçº¯æ“ä½œ |
| `$state.raw` | éå“åº”å¼ | æ™®é€šå¯¹è±¡ | å¤§æ•°æ®/é™æ€æ•°æ® |
| `$state.snapshot` | è·å–å¿«ç…§ | æ™®é€šå¯¹è±¡ | åºåˆ—åŒ–/æ¯”è¾ƒ |

---

## ç»ƒä¹ é¡¹ç›®

### 1. è´­ç‰©è½¦ï¼ˆ30åˆ†é’Ÿï¼‰
- ä½¿ç”¨ `$state` å­˜å‚¨å•†å“
- ä½¿ç”¨ `$derived` è®¡ç®—æ€»ä»·
- ä½¿ç”¨ `$effect` åŒæ­¥ localStorage

### 2. Todo Listï¼ˆ45åˆ†é’Ÿï¼‰
- ä½¿ç”¨ `$state` å­˜å‚¨ä»»åŠ¡
- ä½¿ç”¨ `$derived.by` è¿‡æ»¤ä»»åŠ¡
- ä½¿ç”¨ `$effect` è‡ªåŠ¨ä¿å­˜

### 3. æ•°æ®ä»ªè¡¨æ¿ï¼ˆ60åˆ†é’Ÿï¼‰
- ä½¿ç”¨ `$state.raw` å­˜å‚¨å¤§é‡æ•°æ®
- ä½¿ç”¨ `$derived` è®¡ç®—ç»Ÿè®¡
- ä½¿ç”¨ `$state.snapshot` å¯¼å‡ºæ•°æ®

---

## å¸¸è§é”™è¯¯

### 1. åœ¨ $effect ä¸­ä¿®æ”¹çŠ¶æ€

```svelte
<script>
  let count = $state(0);
  
  // âŒ é”™è¯¯ï¼šæ— é™å¾ªç¯
  $effect(() => {
    count++;
  });
</script>
```

### 2. å¿˜è®°ä½¿ç”¨ $state

```svelte
<script>
  // âŒ é”™è¯¯ï¼šä¸ä¼šå“åº”
  let count = 0;
  
  // âœ… æ­£ç¡®
  let count = $state(0);
</script>
```

### 3. è¿‡åº¦ä½¿ç”¨ $derived.by

```svelte
<script>
  let x = $state(1);
  
  // âŒ ä¸å¿…è¦
  let doubled = $derived.by(() => {
    return x * 2;
  });
  
  // âœ… ç®€å•ç”¨ $derived
  let doubled = $derived(x * 2);
</script>
```

---

## è¿ç§»æŒ‡å—ï¼ˆSvelte 4 â†’ 5ï¼‰

| Svelte 4 | Svelte 5 |
|----------|----------|
| `let x = 0` | `let x = $state(0)` |
| `$: y = x * 2` | `let y = $derived(x * 2)` |
| `$: console.log(x)` | `$effect(() => console.log(x))` |
| `on:click` | `onclick` |
| `export let prop` | `let { prop } = $props()` |

---

## æ€»ç»“

Svelte 5 çš„ Runes ç³»ç»Ÿè®©å“åº”å¼æ›´åŠ æ˜ç¡®å’Œé«˜æ•ˆï¼š

1. **$state** - æ‰€æœ‰å“åº”å¼æ•°æ®çš„èµ·ç‚¹
2. **$derived** - ç®€å•è®¡ç®—çš„é¦–é€‰
3. **$derived.by** - å¤æ‚é€»è¾‘çš„è§£å†³æ–¹æ¡ˆ
4. **$effect** - å‰¯ä½œç”¨çš„ä¸“ç”¨å·¥å…·
5. **$state.raw** - æ€§èƒ½ä¼˜åŒ–çš„åˆ©å™¨
6. **$state.snapshot** - æ•°æ®äº¤æ¢çš„æ¡¥æ¢

æŒæ¡è¿™ 6 ä¸ª Runesï¼Œä½ å°±æŒæ¡äº† Svelte 5 çš„æ ¸å¿ƒã€‚
```

æˆ‘å·²ç»ç”Ÿæˆäº†å®Œæ•´çš„ Svelte 5 Runes æ€»ç»“æ–‡æ¡£ã€‚è¿™ä»½æ–‡æ¡£åŒ…å«ï¼š

- æ¯ä¸ª Rune çš„è¯¦ç»†è¯´æ˜å’Œä»£ç ç¤ºä¾‹
- å®æˆ˜åœºæ™¯å’Œæœ€ä½³å®è·µ
- å†³ç­–æ ‘å¸®åŠ©ä½ å¿«é€Ÿé€‰æ‹©
- å¸¸è§é”™è¯¯å’Œè§£å†³æ–¹æ¡ˆ
- ä» Svelte 4 çš„è¿ç§»æŒ‡å—

ä½ å¯ä»¥å°†è¿™ä»½æ–‡æ¡£ä¿å­˜ä¸º `svelte5-runes-guide.md`ï¼Œä½œä¸ºå­¦ä¹ å’ŒæŸ¥é˜…çš„å‚è€ƒã€‚éœ€è¦æˆ‘è¡¥å……å…¶ä»–å†…å®¹å—ï¼Ÿ
